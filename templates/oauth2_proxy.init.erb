# MANAGED BY PUPPET: puppet-oauth2_proxy/templates/oauth2_proxy.init.erb
description "oauth2_proxy@<%= @title %>"
author "Brian E Clow <brianeclow@gmail.com>"

start on filesystem
stop on runlevel [!2345]

respawn
respawn limit 10 5
console log

script
  exec start-stop-daemon \
       --start \
       --make-pidfile \
       --pidfile "/var/run/oauth2_proxy@<%= @title %>.pid" \
       --chuid "<%= @_user %>:<%= @_group %>" \
       --chdir "<%= @_chdir %>" \
       --startas /bin/bash -- -c "exec <%= @_command %> &>> <%= @_log_path %>"
end script

pre-start script
    echo "[`date`] Starting oauth2_proxy@<%= @title %>" >> /var/log/oauth2_proxy/<%= @title %>.log
end script

pre-stop script
    rm /var/run/oauth2_proxy@<%= @title %>.pid
    echo "[`date`] Stopping oauth2_proxy@<%= @title %>" >> /var/log/oauth2_proxy/<%= @title %>.log
end script
